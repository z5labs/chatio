(self["webpackChunkchatio"]=self["webpackChunkchatio"]||[]).push([[523],{52523:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>we});var o=n(83673),i=n(62323);const a=(0,o.HX)("data-v-37416af6");(0,o.dD)("data-v-37416af6");const r={class:"absolute-left column justify-end items-start",style:{"z-index":"2"}},l={class:"absolute-right column justify-end items-end",style:{"z-index":"2"}};(0,o.Cn)();const s=a(((e,t,n,s,u,d)=>{const c=(0,o.up)("q-btn"),p=(0,o.up)("InviteButton"),m=(0,o.up)("q-tooltip"),g=(0,o.up)("q-badge"),f=(0,o.up)("Call"),y=(0,o.up)("q-page"),b=(0,o.up)("q-page-container"),v=(0,o.up)("Chat"),w=(0,o.up)("Participants"),h=(0,o.up)("q-drawer"),k=(0,o.up)("q-layout");return(0,o.wg)(),(0,o.j4)(k,{view:"lHh Lpr lFf"},{default:a((()=>[(0,o.Wm)(b,null,{default:a((()=>[(0,o.Wm)(y,null,{default:a((()=>[(0,o.Wm)("div",r,[(0,o.Wm)(p,{callId:e.id},{default:a((({prompt:t})=>[(0,o.Wm)(c,{onClick:t,icon:"person_add",label:e.iconOnly?"":"Invite",flat:""},null,8,["onClick","label"])])),_:1},8,["callId"]),(0,o.Wm)(c,{onClick:e.toggleMic,icon:e.muted?"mic_off":"mic",label:e.iconOnly?"":"Audio",flat:""},{default:a((()=>[(0,o.Wm)(m,{anchor:"center right",self:"center left"},{default:a((()=>[(0,o.Uk)((0,i.zw)(e.muted?"Unmute":"Mute"),1)])),_:1})])),_:1},8,["onClick","icon","label"]),(0,o.Wm)(c,{onClick:e.toggleVideo,icon:e.streaming?"videocam":"videocam_off",label:e.iconOnly?"":"Video",flat:""},{default:a((()=>[(0,o.Wm)(m,{anchor:"center right",self:"center left"},{default:a((()=>[(0,o.Uk)((0,i.zw)(e.streaming?"Disable":"Enable"),1)])),_:1})])),_:1},8,["onClick","icon","label"])]),(0,o.Wm)("div",l,[(0,o.Wm)(c,{onClick:e.toggleParticipants,"icon-right":"people",label:e.iconOnly?"":"Participants",flat:""},null,8,["onClick","label"]),(0,o.Wm)(c,{onClick:e.toggleChat,"icon-right":"message",label:e.iconOnly?"":"Chat",flat:""},{default:a((()=>[e.missedMessages>0?((0,o.wg)(),(0,o.j4)(g,{key:0,color:"red",floating:""},{default:a((()=>[(0,o.Uk)((0,i.zw)(e.missedMessages),1)])),_:1})):(0,o.kq)("",!0)])),_:1},8,["onClick","label"])]),(0,o.Wm)(f)])),_:1})])),_:1}),(0,o.Wm)(h,{modelValue:e.openDrawer,"onUpdate:modelValue":t[1]||(t[1]=t=>e.openDrawer=t),side:"right",width:300,breakpoint:500},{default:a((()=>[e.viewChat?((0,o.wg)(),(0,o.j4)(v,{key:0,onMessage:e.sendMessage,messages:e.messages},null,8,["onMessage","messages"])):(0,o.kq)("",!0),e.viewParticipants?((0,o.wg)(),(0,o.j4)(w,{key:1,participants:e.participants},null,8,["participants"])):(0,o.kq)("",!0)])),_:1},8,["modelValue"])])),_:1})}));var u=n(61959),d=n(10556),c=n(84518),p=n(94740),m=function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{s(o.next(e))}catch(t){a(t)}}function l(e){try{s(o["throw"](e))}catch(t){a(t)}}function s(e){e.done?n(e.value):i(e.value).then(r,l)}s((o=o.apply(e,t||[])).next())}))};const g=e=>{const t=(0,u.iH)([]);return e.peerStore.on("peer",(e=>{const n=t.value.map((e=>e.id));n.includes(e)||t.value.push({id:e})})),e.connectionManager.on("peer:disconnect",(e=>{const n=e.remotePeer.toB58String();t.value=t.value.filter((e=>e.id.toB58String()!==n))})),t},f=e=>t=>t.setAudience(e),y=e=>t=>t.setExpirationTime(e),b=e=>t=>t.setNotBefore(e),v=(e,t,...n)=>{const o=new c.N(e).setIssuedAt().setIssuer(t.toB58String());return n?n.reduce(((e,t)=>t(e)),o):o},w=(e,t,n)=>m(void 0,void 0,void 0,(function*(){const o=yield crypto.subtle.importKey("jwk",e.privKey._key,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!0,["sign"]),i=yield t.setProtectedHeader({alg:"RS256"}).sign(o),a=new TextEncoder;return yield new p.B(a.encode(i)).setProtectedHeader({alg:"dir",enc:"A256GCM"}).encrypt(n)}));var h=n(46794),k=n.n(h),C=n(1603),I=n.n(C),S=n(41193),W=n.n(S),q=n(67199),_=n.n(q);const F={user:"",created:0},V={encode(e,t=_().Writer.create()){return""!==e.user&&t.uint32(10).string(e.user),0!==e.body.length&&t.uint32(18).bytes(e.body),0!==e.created&&t.uint32(24).uint64(e.created),t},decode(e,t){const n=e instanceof _().Reader?e:new(_().Reader)(e);let o=void 0===t?n.len:n.pos+t;const i=Object.assign({},F);i.body=new Uint8Array;while(n.pos<o){const e=n.uint32();switch(e>>>3){case 1:i.user=n.string();break;case 2:i.body=n.bytes();break;case 3:i.created=U(n.uint64());break;default:n.skipType(7&e);break}}return i},fromJSON(e){const t=Object.assign({},F);return t.body=new Uint8Array,void 0!==e.user&&null!==e.user?t.user=String(e.user):t.user="",void 0!==e.body&&null!==e.body&&(t.body=P(e.body)),void 0!==e.created&&null!==e.created?t.created=Number(e.created):t.created=0,t},toJSON(e){const t={};return void 0!==e.user&&(t.user=e.user),void 0!==e.body&&(t.body=Z(void 0!==e.body?e.body:new Uint8Array)),void 0!==e.created&&(t.created=e.created),t},fromPartial(e){const t=Object.assign({},F);return void 0!==e.user&&null!==e.user?t.user=e.user:t.user="",void 0!==e.body&&null!==e.body?t.body=e.body:t.body=new Uint8Array,void 0!==e.created&&null!==e.created?t.created=e.created:t.created=0,t}};var A=(()=>{if("undefined"!==typeof A)return A;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw"Unable to locate global object"})();const H=A.atob||(e=>A.Buffer.from(e,"base64").toString("binary"));function P(e){const t=H(e),n=new Uint8Array(t.length);for(let o=0;o<t.length;++o)n[o]=t.charCodeAt(o);return n}const j=A.btoa||(e=>A.Buffer.from(e,"binary").toString("base64"));function Z(e){const t=[];for(const n of e)t.push(String.fromCharCode(n));return j(t.join(""))}function U(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new A.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}_().util.Long!==W()&&(_().util.Long=W(),_().configure());var D=function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{s(o.next(e))}catch(t){a(t)}}function l(e){try{s(o["throw"](e))}catch(t){a(t)}}function s(e){e.done?n(e.value):i(e.value).then(r,l)}s((o=o.apply(e,t||[])).next())}))};const M=(e,t,n)=>{const o=`/chatio/${t.callId}/chat/1.0.0`,i=O(n);return e.pubsub.on(o,i),e.pubsub.subscribe(o),{unsubscribe:()=>{e.pubsub.removeListener(o,i),e.pubsub.unsubscribe(o)},publish:t=>D(void 0,void 0,void 0,(function*(){const n=V.encode({user:t.user,body:k()(t.body),created:t.created}).finish();yield e.pubsub.publish(o,n)}))}},O=e=>t=>{if(!t||!t.data)return;const n=V.decode(t.data);e({user:n.user,body:I()(n.body),created:n.created})};function x(e,t,n,i,a,r){return(0,o.WI)(e.$slots,"default",{prompt:e.prompt})}var Q=n(48825),R=n(98880);const B=(0,o.Wm)("div",{class:"text-h6"}," Invite ",-1),T={key:1,class:"col"};function E(e,t,n,i,a,r){const l=(0,o.up)("q-card-section"),s=(0,o.up)("InviteForm"),u=(0,o.up)("q-btn"),d=(0,o.up)("q-input"),c=(0,o.up)("q-card-actions"),p=(0,o.up)("q-card"),m=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.j4)(m,{ref:"dialogRef",onHide:e.onDialogHide},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"q-dialog-plugin"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[B])),_:1}),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Wm)(R.uT,{mode:"out-in",name:"invite"},{default:(0,o.w5)((()=>[e.showForm?((0,o.wg)(),(0,o.j4)(s,{key:0,recipients:e.options,recipient:e.invite.recipient,"onUpdate:recipient":t[1]||(t[1]=t=>e.invite.recipient=t),datetime:e.invite.datetime,"onUpdate:datetime":t[2]||(t[2]=t=>e.invite.datetime=t),duration:e.invite.duration,"onUpdate:duration":t[3]||(t[3]=t=>e.invite.duration=t),password:e.invite.password,"onUpdate:password":t[4]||(t[4]=t=>e.invite.password=t)},null,8,["recipients","recipient","datetime","duration","password"])):((0,o.wg)(),(0,o.j4)("div",T,[(0,o.Wm)(d,{modelValue:e.token,"onUpdate:modelValue":t[5]||(t[5]=t=>e.token=t),label:"Token",readonly:""},{after:(0,o.w5)((()=>[(0,o.Wm)(u,{onClick:e.copy,icon:"content_copy",round:"",dense:"",flat:""},null,8,["onClick"])])),_:1},8,["modelValue"])]))])),_:1})])),_:1}),(0,o.Wm)(c,{align:"right"},{default:(0,o.w5)((()=>[e.showForm?((0,o.wg)(),(0,o.j4)(u,{key:0,color:"primary",label:"close",onClick:e.onCancelClick,flat:""},null,8,["onClick"])):((0,o.wg)(),(0,o.j4)(u,{key:1,color:"secondary",label:"back",onClick:t[6]||(t[6]=t=>e.showForm=!e.showForm),flat:""})),e.showForm?((0,o.wg)(),(0,o.j4)(u,{key:2,color:"primary",label:"generate",onClick:t[7]||(t[7]=t=>e.showForm=!e.showForm),flat:""})):((0,o.wg)(),(0,o.j4)(u,{key:3,color:"primary",label:"dismiss",onClick:e.onOKClick,flat:""},null,8,["onClick"]))])),_:1})])),_:1})])),_:1},8,["onHide"])}var N=n(91701);const K={class:"col"},$={class:"row q-gutter-sm"};function L(e,t,n,i,a,r){const l=(0,o.up)("q-select"),s=(0,o.up)("q-input");return(0,o.wg)(),(0,o.j4)("div",K,[(0,o.Wm)(l,{modelValue:e.rec,"onUpdate:modelValue":t[1]||(t[1]=t=>e.rec=t),options:e.recipients,label:"Recipient"},null,8,["modelValue","options"]),(0,o.Wm)("div",$,[(0,o.Wm)(s,{modelValue:e.date,"onUpdate:modelValue":t[2]||(t[2]=t=>e.date=t),type:"date",label:"Call starts on",class:"col"},null,8,["modelValue"]),(0,o.Wm)(s,{modelValue:e.time,"onUpdate:modelValue":t[3]||(t[3]=t=>e.time=t),type:"time",label:"Call starts at",class:"col"},null,8,["modelValue"])]),(0,o.Wm)(s,{modelValue:e.dur,"onUpdate:modelValue":t[4]||(t[4]=t=>e.dur=t),type:"number",label:"Call will last for",suffix:"minutes(s)"},null,8,["modelValue"]),(0,o.Wm)(s,{modelValue:e.pwd,"onUpdate:modelValue":t[5]||(t[5]=t=>e.pwd=t),type:e.pwdType,label:"Password"},null,8,["modelValue","type"])])}const z=(0,o.aZ)({name:"InviteForm",props:{recipients:{type:Array,required:!0},recipient:{type:String,required:!0},datetime:{type:Object,required:!0},duration:{type:Number,required:!0},password:{type:String,required:!0}},emits:["update:recipient","update:datetime","update:duration","update:password"],setup(e,{emit:t}){const n=(0,o.Fl)({get:()=>e.recipient,set:e=>t("update:recipient",e)}),i=(0,o.Fl)({get:()=>{const t=e.datetime.getFullYear();let n=e.datetime.getMonth()+1,o=e.datetime.getDate();return n<10&&(n="0"+n.toString()),o<10&&(o="0"+o.toString()),`${t}-${n}-${o}`},set:n=>{const[o,i,a]=n.split("-").map((e=>e.startsWith("0")?e.slice(1):e)).map((e=>parseInt(e)));t("update:datetime",new Date(o,i-1,a,e.datetime.getHours(),e.datetime.getMinutes()))}}),a=(0,o.Fl)({get:()=>{let t=e.datetime.getHours(),n=e.datetime.getMinutes();return t<10&&(t="0"+t.toString()),n<10&&(n="0"+n.toString()),`${t}:${n}`},set:n=>{const[o,i]=n.split(":").map((e=>e.startsWith("0")?e.slice(1):e)).map((e=>parseInt(e)));t("update:datetime",new Date(e.datetime.getFullYear(),e.datetime.getMonth(),e.datetime.getDate(),o,i))}}),r=(0,o.Fl)({get:()=>e.duration,set:e=>t("update:duration",e)}),l=(0,o.Fl)({get:()=>e.password,set:e=>t("update:password",e)}),s=(0,u.iH)(!1),d=(0,o.Fl)((()=>s.value?"text":"password"));return{rec:n,date:i,time:a,dur:r,pwd:l,showPwd:s,pwdType:d}}});var G=n(27236),X=n(34842),Y=n(7518),J=n.n(Y);z.render=L;const ee=z;J()(z,"components",{QSelect:G.Z,QInput:X.Z});var te=function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{s(o.next(e))}catch(t){a(t)}}function l(e){try{s(o["throw"](e))}catch(t){a(t)}}function s(e){e.done?n(e.value):i(e.value).then(r,l)}s((o=o.apply(e,t||[])).next())}))};const ne=(0,o.aZ)({name:"InviteDialog",components:{InviteForm:ee},props:{callId:{type:String,required:!0},hostId:{type:Object,required:!0}},emits:[...N.Z.emits],setup(e){const{dialogRef:t,onDialogHide:n,onDialogOK:i,onDialogCancel:a}=(0,N.Z)(),r=(0,u.iH)(!0),l=(0,u.iH)(["Anyone"]),s=(0,u.iH)(""),d=new Date,c=(0,u.qj)({recipient:"Anyone",datetime:d,duration:120,password:""});(0,o.YP)(c,(({recipient:t,datetime:n,duration:o,password:i})=>te(this,void 0,void 0,(function*(){const a=v({callId:e.callId,signingKey:"secret"},e.hostId,y(o),f(t),b(n.getTime())),r=new TextEncoder,l=r.encode(i),u=yield crypto.subtle.digest("SHA-256",l),d=yield w(e.hostId,a,new Uint8Array(u));s.value=d}))));const p=()=>te(this,void 0,void 0,(function*(){return yield navigator.clipboard.writeText(s.value)}));return{showForm:r,options:l,invite:c,token:s,copy:p,dialogRef:t,onDialogHide:n,onOKClick(){i()},onCancelClick:a}}});var oe=n(46778),ie=n(10151),ae=n(25589),re=n(2165),le=n(99367);ne.render=E;const se=ne;J()(ne,"components",{QDialog:oe.Z,QCard:ie.Z,QCardSection:ae.Z,QInput:X.Z,QBtn:re.Z,QCardActions:le.Z});const ue=(0,o.aZ)({name:"InviteButton",props:{callId:{type:String,required:!0},signingKey:{type:String}},setup(e){const t=(0,Q.Z)(),n=(0,d.useStore)(),o=()=>{t.dialog({component:se,componentProps:{callId:e.callId,hostId:n.state.libp2p.peerId}}).onOk((()=>console.log("ok"))).onCancel((()=>console.log("cancel"))).onDismiss((()=>console.log("dismiss")))};return{prompt:o}}});ue.render=x;const de=ue;var ce=function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function r(e){try{s(o.next(e))}catch(t){a(t)}}function l(e){try{s(o["throw"](e))}catch(t){a(t)}}function s(e){e.done?n(e.value):i(e.value).then(r,l)}s((o=o.apply(e,t||[])).next())}))};const pe=(0,o.aZ)({name:"CallLayout",components:{InviteButton:de,Call:(0,o.RC)((()=>n.e(983).then(n.bind(n,87983)))),Chat:(0,o.RC)((()=>Promise.all([n.e(736),n.e(927)]).then(n.bind(n,25927)))),Participants:(0,o.RC)((()=>Promise.all([n.e(736),n.e(713)]).then(n.bind(n,49713))))},props:{id:{type:String,required:!0},pwd:{type:String}},setup(e){const t=(0,Q.Z)(),n=(0,d.useStore)(),i=(0,o.Fl)((()=>n.state.username)),a=(0,o.f3)("node"),r=(0,u.iH)(!1),l=(0,u.iH)(!1),s=(0,u.iH)(!1),c=(0,u.iH)(!1),p=(0,o.Fl)((()=>s.value||c.value)),m=(0,o.Fl)((()=>t.screen.lt.md)),f=g(a),y=(0,u.iH)([]),b=(0,u.iH)(0),v=()=>r.value=!r.value,w=()=>l.value=!l.value,h=()=>{s.value=!s.value,c.value=!1,b.value=0},k=()=>{c.value=!c.value,s.value=!1},{publish:C,unsubscribe:I}=M(a,{callId:e.id,signingKey:""},(e=>{y.value.push(e),!s.value&&n.state.notifications.appearOnChatMessage&&(b.value+=1,t.notify({group:"chat",position:"top",icon:"message",message:e.body,actions:[{label:"Respond",handler:h},{label:"Dismiss"}]}))})),S=e=>ce(this,void 0,void 0,(function*(){const t=Date.now(),n={user:i.value,body:e,created:t};y.value.push(n),yield C(n)}));return(0,o.Ah)((()=>{I()})),{iconOnly:m,muted:r,streaming:l,toggleMic:v,toggleVideo:w,viewChat:s,viewParticipants:c,openDrawer:p,toggleParticipants:k,toggleChat:h,participants:f,missedMessages:b,messages:y,sendMessage:S,prompt}}});var me=n(19214),ge=n(72652),fe=n(24379),ye=n(5363),be=n(69721),ve=n(52901);pe.render=s,pe.__scopeId="data-v-37416af6";const we=pe;J()(pe,"components",{QLayout:me.Z,QPageContainer:ge.Z,QPage:fe.Z,QBtn:re.Z,QTooltip:ye.Z,QBadge:be.Z,QDrawer:ve.Z})}}]);